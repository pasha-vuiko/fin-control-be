# Repository Guidelines

## Project Structure & Module Organization
- `src/`: NestJS app (Fastify). Feature code lives under `src/api`, shared utilities under `src/shared`.
- `prisma/`: Prisma schema, migrations, and generated artifacts.
- `test/`: Unit, e2e, and helpers; `unit-tests-setup.ts` stubs network/DB.
- `dist/`: Build output (generated by `npm run build`).
- Aliases: `@api/* -> src/api/*`, `@shared/* -> src/shared/*`.

## Build, Test, and Development Commands
- Install: `npm install` (Node `22.18.0`).
- Dev server: `npm run start:dev` (watch mode, loads `.env`).
- Build: `npm run build` (outputs to `dist/`).
- Run built app: `npm start` or `npm run start:prod`.
- DB migrations: `npm run migrations:run` (Prisma deploy).
- Local infra: `docker compose up` (PostgreSQL, Valkey, SonarQube, etc.).
- Lint/format: `npm run lint`, `npm run lint:fix`, `npm run format`.
- Tests: `npm test` (Vitest), coverage `npm run test:cov`, e2e `npm run test:e2e`.
- Sonar scan: `npm run sonar` (requires `.env` and SonarQube running).

## Coding Style & Naming Conventions
- Formatter: Prettier (2 spaces, `printWidth: 90`, single quotes, sorted imports).
- Lint: ESLint (security + TypeScript rules; function return types encouraged).
- Paths: use `@api`/`@shared` aliases; relative paths last.
- Naming: classes/DTOs `PascalCase`; variables/functions `camelCase`; interfaces `IPascalCase` (enforced); env vars `UPPER_SNAKE_CASE`.
- Keep functions small (rule: max ~40 lines).

## Testing Guidelines
- Framework: Vitest with SWC; globals enabled.
- Naming: unit `*.spec.ts`; e2e `*.e2e-spec.ts` (see `test/vitest.config.e2e.mjs`).
- Isolation: `test/unit-tests-setup.ts` blocks outbound HTTP and DB â€” mock/stub data access.
- Run suites locally: `npm test`, e2e after `docker compose up` and migrations.

## Commit & Pull Request Guidelines
- Commits: Conventional Commits (semantic-release). Examples: `feat(api): add expense endpoint`, `fix(db): handle unique violation`.
- Before push: `npm run lint && npm test` (and `npm run build` for CI parity).
- PRs: clear description, linked issues, repro steps, and screenshots/logs if relevant. Include DB changes/migrations and update docs.
- Keep PRs focused and small; request review from code owners/modules you touch.

## Security & Configuration Tips
- Never commit secrets. Use `.env` (see `.env.example`).
- Run local services via `docker compose up`. Point `DATABASE_URL` to the compose Postgres by default.
- Regenerate Prisma client after schema changes: `npm run migrations:run`.
